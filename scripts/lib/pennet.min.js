"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}}(function(){var Counter,checkGenotype,checkGenotypes,checkedof,clearError,combineGametes,countIt,createOutput,createPhenotypeInput,delws,div,ejoin,element,evalPhenotype,fail,first,htmlset,keys,last,makeGametes,makeKeyCells,makeValueCells,max,maxKey,maxValue,mergeStrings,min,mul,onChangeText,runApplication,sub,sum,valueof,values,valueset;sub=function sub(x,y){return x-y};sum=function sum(x,y){if(y==null){return x.reduce(document.flexibel.sum)}return x+y};mul=function mul(x,y){if(y==null){return x.reduce(document.flexibel.mul)}return x*y};div=function div(x,y){return x/y};min=function min(x,y){if(y==null){return x.reduce(document.flexibel.min)}if(x<y){return x}else{return y}};max=function max(x,y){if(y==null){return x.reduce(document.flexibel.max)}if(x>y){return x}else{return y}};last=function last(container){return container[container.length-1]};first=function first(container){return container[0]};element=function element(id){return document.getElementById(id)};valueset=function valueset(id,value){return document.flexibel.element(id).value=value};valueof=function valueof(id){return document.flexibel.element(id).value};checkedof=function checkedof(id){return document.flexibel.element(id).checked};htmlset=function htmlset(id,html){return document.flexibel.element(id).innerHTML=html};ejoin=function ejoin(values){return values.join("")};delws=function delws(str,sym){return str.replace(/\s+/g,"")};values=function values(map){return _toConsumableArray(map.values())};keys=function keys(map){return _toConsumableArray(map.keys())};maxKey=function maxKey(map){return document.flexibel.keys(map).reduce(document.flexibel.max)};maxValue=function maxValue(map){return document.flexibel.values(map).reduce(document.flexibel.max)};countIt=function countIt(map,it){if(map.has(it)){return map.set(it,map.get(it)+1)}else{return map.set(it,1)}};makeValueCells=function makeValueCells(map){var ref,results,v;ref=map.values();results=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=ref[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){v=_step.value;results.push("<td>".concat(v,"</td>"))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}return results};makeKeyCells=function makeKeyCells(map){var k,ref,results;ref=map.keys();results=[];var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=ref[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){k=_step2.value;results.push("<td>".concat(k,"</td>"))}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return results};document.flexibel={makeKeyCells:makeKeyCells,makeValueCells:makeValueCells,countIt:countIt,maxValue:maxValue,maxKey:maxKey,keys:keys,values:values,delws:delws,ejoin:ejoin,htmlset:htmlset,checkedof:checkedof,valueof:valueof,valueset:valueset,element:element,first:first,last:last,max:max,min:min,sum:sum,sub:sub,mul:mul,div:div};Counter=function(){function Counter(){_classCallCheck(this,Counter);this.counter=new Map}_createClass(Counter,[{key:"count",value:function count(element){return countIt(this.counter,element)}},{key:"getSize",value:function getSize(){return this.counter.size}},{key:"getTable",value:function getTable(tableName){var builder;return builder='<label class="tblbl">'.concat(tableName,': </label><br>\n<table class="mdl-data-table mdl-js-data-table">\n\t<tr>').concat(ejoin(makeKeyCells(this.counter)),"</tr>\n\t<tr>").concat(ejoin(makeValueCells(this.counter)),"</tr>\n</table>")}}]);return Counter}();runApplication=function runApplication(){var gametesFirst,gametesSecond,genotype1,genotype2;clearError();genotype1=valueof("genotype1").trim();genotype2=valueof("genotype2").trim();if(!checkGenotypes(genotype1,genotype2)){return}gametesFirst=makeGametes(genotype1);gametesSecond=genotype1===genotype2?gametesFirst:makeGametes(genotype2);return htmlset("tableplace",createOutput(gametesFirst,gametesSecond))};fail=function fail(error){htmlset("errorlogs",'<p style="color: red;">'.concat(error,"</p>"));return false};clearError=function clearError(){return fail("")};createOutput=function createOutput(g1,g2){var builder,genotype,genotypeCounter,i,j,l,len,len1,len2,m,n,phenotype,phenotypeCounter,subbuilder;genotypeCounter=new Counter;phenotypeCounter=new Counter;builder="<br><label class=\"tblbl\">Решётка Пеннета: </label><br>\n<table class='mdl-data-table mdl-js-data-table'><tr><td></td>";for(l=0,len=g2.length;l<len;l++){i=g2[l];builder+="<td>".concat(i,"</td>")}builder+="</tr>";for(m=0,len1=g1.length;m<len1;m++){i=g1[m];builder+="<tr><td>".concat(i,"</td>");for(n=0,len2=g2.length;n<len2;n++){j=g2[n];genotype=combineGametes(i,j);if(genotype===null){return""}phenotype=evalPhenotype(genotype);genotypeCounter.count(genotype);phenotypeCounter.count(phenotype);builder+=phenotype!==null?"<td>".concat(genotype,"<br>(").concat(phenotype,")</td>"):"<td>".concat(genotype,"</td>")}builder+="</tr>"}subbuilder=genotypeCounter.getTable("Расщепление по генотипу");if(phenotypeCounter.getSize()>1){subbuilder+="<br>"+phenotypeCounter.getTable("Расщепление по фенотипу")}return builder+"</table><br><div>".concat(subbuilder,"</div>")};evalPhenotype=function evalPhenotype(genotype){var allel,l,len,phenotypeParts,val;phenotypeParts=new Map;for(l=0,len=genotype.length;l<len;l++){allel=genotype[l];val=valueof("inputFor"+allel);if(val===""){continue}if(allel.toUpperCase()===allel){phenotypeParts.set(allel,val)}if(!phenotypeParts.has(allel.toUpperCase())){phenotypeParts.set(allel,val)}}if(!phenotypeParts.size){return null}return values(phenotypeParts).join(", ")};combineGametes=function combineGametes(g1,g2){var i;if(g1.length!==g2.length){return fail("wrong gamet length")}return ejoin(function(){var l,ref,results;results=[];for(i=l=0,ref=g1.length;0<=ref?l<ref:l>ref;i=0<=ref?++l:--l){results.push(g1[i]<g2[i]?g1[i]+g2[i]:g2[i]+g1[i])}return results}())};makeGametes=function makeGametes(genotype){var _helper;_helper=function helper(genotype,position){var gams;if(position>=genotype.length){return}gams=_helper(genotype,position+2);if(gams===void 0){return _toConsumableArray(new Set([genotype[position],genotype[position+1]]))}if(genotype[position]===genotype[position+1]){return gams.map(function(i){return genotype[position]+i})}else{return[].concat(_toConsumableArray(gams.map(function(i){return genotype[position]+i})),_toConsumableArray(gams.map(function(i){return genotype[position+1]+i})))}};return _helper(genotype,0)};onChangeText=function onChangeText(){var allel,alleles,gametes;clearError();htmlset("gametparams","");if(!checkGenotypes(valueof("genotype1"),valueof("genotype2"))){return}gametes=makeGametes(valueof("genotype1"));if(gametes===null){return}alleles=mergeStrings(gametes[0].toUpperCase(),gametes[0].toLowerCase());return htmlset("gametparams",function(){var l,len,results;results=[];for(l=0,len=alleles.length;l<len;l++){allel=alleles[l];results.push(createPhenotypeInput(allel))}return results}().join(""))};createPhenotypeInput=function createPhenotypeInput(allel){return'<div class="mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet mdl-cell--4-col-phone">\n\t<div class="mdl-textfield mdl-js-textfield">\n\t\t<label class="tblbl">Фенотип '.concat(allel,'</label>\n\t\t<input type="text" class="mdl-textfield__input" id="inputFor').concat(allel,'">\n\t</div>\n</div>')};checkGenotype=function checkGenotype(genotype){var member,msg;msg="Введён некорректный генотип ".concat(genotype);if(genotype.length%2!==0){return fail(msg)}member=[];return true};checkGenotypes=function checkGenotypes(genotype1,genotype2){var i,l,msg,ref;if(!checkGenotype(genotype1)){return false}if(!checkGenotype(genotype2)){return false}msg="Генотипы ".concat(genotype1," и ").concat(genotype2," некорректны");if(genotype1.length!==genotype2.length){return fail(msg)}for(i=l=0,ref=genotype1.length;0<=ref?l<ref:l>ref;i=0<=ref?++l:--l){if(genotype1[i].toLowerCase()!==genotype2[i].toLowerCase()){return fail(msg)}}return true};mergeStrings=function mergeStrings(string1,string2){var i;return function(){var l,ref,results;results=[];for(i=l=0,ref=string1.length;0<=ref?l<ref:l>ref;i=0<=ref?++l:--l){results.push(string1[i]+string2[i])}return results}().join("")};element("genotype1").addEventListener("input",onChangeText);element("genotype2").addEventListener("input",onChangeText);element("runButton").addEventListener("click",runApplication)}).call(void 0);